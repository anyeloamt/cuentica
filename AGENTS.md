# Cuentica — Repository Guidelines

## Project Overview

**Cuentica** is a simple budgeting PWA. Each budget is a "wallet" with an income/expense table and a total. Offline-first, optional sync, PDF export.

- **Stack**: React 18 + Vite 5 + TypeScript 5 + Dexie.js 4.3 + jsPDF
- **Architecture**: Feature-based (components → hooks → lib → context → types)
- **Hosting**: Vercel (free tier)
- **Status**: Pre-MVP (scaffolding phase)

## Project Structure

```
src/
├── components/           # UI components (JSX only, no business logic)
│   ├── Layout/           # Header, BottomTotal
│   ├── Home/             # WalletList, WalletCard
│   ├── Budget/           # BudgetTable, BudgetRow, BudgetFooter
│   ├── Export/           # PdfExport
│   └── Settings/         # ThemeToggle
├── hooks/                # Custom hooks (stateful logic, side effects)
│   ├── useWallets.ts
│   ├── useBudgetItems.ts
│   └── useOfflineStatus.ts
├── lib/                  # Pure functions, DB config, API calls
│   ├── db.ts             # Dexie.js configuration and schema
│   ├── pdf.ts            # jsPDF generation
│   └── share.ts          # Web Share API + fallback
├── context/              # Shared state providers
│   ├── ThemeContext.tsx
│   └── DatabaseContext.tsx
├── types/                # TypeScript interfaces and types
│   └── index.ts
├── styles/               # Global CSS and theme variables
│   ├── theme.css
│   └── global.css
├── App.tsx
├── main.tsx
└── vite-env.d.ts
```

## Architecture Rules

### Layer Dependencies

| Layer         | Can Import                     | Cannot Import                 | Purpose                   |
| ------------- | ------------------------------ | ----------------------------- | ------------------------- |
| `components/` | hooks/, lib/, context/, types/ | —                             | UI rendering, JSX         |
| `hooks/`      | lib/, context/, types/         | components/                   | Stateful logic, effects   |
| `lib/`        | types/ only                    | components/, hooks/, context/ | Pure functions, DB, utils |
| `context/`    | hooks/, lib/, types/           | components/                   | Shared state providers    |
| `types/`      | Nothing                        | Everything                    | Interfaces, type defs     |

**Dependency direction**: Components → Hooks → Lib → Types (never reverse)

### Key Conventions

- **No business logic in components** — extract to hooks or lib/
- **No direct Dexie.js calls in components** — use hooks (`useWallets`, `useBudgetItems`)
- **CSS Custom Properties for theming** — no CSS-in-JS libraries
- **Functional components only** — no class components
- **Explicit return types** on all exported functions

## Build, Test, and Development Commands

```bash
# Development
npm run dev                    # Start Vite dev server

# Build
npm run build                  # Production build
npm run preview                # Preview production build locally

# Quality
npm run lint                   # ESLint
npm run typecheck              # tsc --noEmit (type checking without emit)
npm test                       # Vitest (unit tests)
npm run test:coverage          # Vitest with coverage

# Verification (run after any code changes)
npm run lint && npm run typecheck && npm test

# PWA
# Service worker is auto-generated by vite-plugin-pwa on build
```

## Agent Workflow

After making code changes, run:

```bash
npm run lint && npm run typecheck && npm test
```

If adding new features, ensure:

1. PWA still works offline (`npm run build && npm run preview`, then test in airplane mode)
2. Lighthouse PWA score remains > 95

## Coding Style & Naming Conventions

- TypeScript strict mode (`strict: true` in tsconfig)
- 2-space indentation
- `camelCase` for variables/functions, `PascalCase` for components/types/interfaces
- File naming: `PascalCase.tsx` for components, `camelCase.ts` for everything else
- Prefer named exports over default exports
- No `any`, `@ts-ignore`, or `@ts-expect-error`

## Testing Guidelines

- Framework: Vitest + React Testing Library
- Co-locate tests: `ComponentName.test.tsx` next to `ComponentName.tsx`
- Test behavior, not implementation (what the user sees, not internal state)
- Mock Dexie.js for unit tests (don't hit real IndexedDB)

## Commit & Pull Request Guidelines

- Conventional Commits: `feat:`, `fix:`, `chore:`, `refactor:`, `docs:`, `test:`
- PRs include: summary, what changed, confirmation that lint + typecheck + tests pass
- Never commit secrets, API keys, or `.env` files

## Data Model Reference

```typescript
interface SyncableEntity {
  id?: string;
  createdAt: number;
  updatedAt: number;
  syncStatus?: 'pending' | 'synced';
  deleted?: boolean;
}

interface Wallet extends SyncableEntity {
  name: string;
  order: number;
  color?: string;
  categoryId?: string;
}

interface BudgetItem extends SyncableEntity {
  walletId: string;
  order: number;
  name: string;
  type: '+' | '-';
  amount: number;
  date?: string;
  categoryTag?: string;
}
```

## Current Phase

**Phase 1 — Local MVP** (Week 1-2)

- See `ROADMAP.md` for full sprint breakdown
- Focus: wallets CRUD, budget table, PDF export, PWA offline, Vercel deploy

## Workflow Overrides

### /work-issue — Plan Step

The `/plan` step (Step 5 in work-issue) is **optional** at the orchestrator's discretion.

| Complexity                                               | Plan? | Rationale                                                  |
| -------------------------------------------------------- | ----- | ---------------------------------------------------------- |
| Config/setup tasks (PWA, tooling, CI)                    | Skip  | Well-defined scope, exploration provides enough context    |
| UI-heavy features (new screens, components)              | Skip  | Delegate directly to `visual-engineering` with clear specs |
| Complex logic (data flows, state machines, multi-module) | Plan  | Architecture decisions benefit from upfront planning       |
| Ambiguous scope                                          | Plan  | Reduces rework risk                                        |

When skipping, the orchestrator must still provide equivalent context in the implementation delegation prompt (acceptance criteria, technical constraints, affected files).

## Key References

- `PRD.md` — Full product requirements
- `ROADMAP.md` — Phased delivery plan
- `PORTABILITY-PLAN.md` — Skills porting plan from expense-ai
